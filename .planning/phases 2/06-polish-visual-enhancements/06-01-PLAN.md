---
phase: 06-polish-visual-enhancements
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/detection/WebcamView.tsx
autonomous: true

must_haves:
  truths:
    - "Face mesh color smoothly transitions between score-based colors without abrupt jumps at threshold boundaries"
    - "Stacked text metrics (Yaw/Pitch/Roll, Gaze, Face%, FPS) and Human.js face labels are visible during calibration but disappear once calibration completes"
    - "No console.log spam in the browser console during normal operation (~5 FPS draw loop produces zero log output)"
  artifacts:
    - path: "src/components/detection/WebcamView.tsx"
      provides: "Smooth color lerp, conditional metrics, clean logging"
      contains: "currentColorRef"
  key_links:
    - from: "src/components/detection/WebcamView.tsx"
      to: "human.draw.options"
      via: "lerped color applied before human.draw.all()"
      pattern: "Object\\.assign\\(human\\.draw\\.options"
    - from: "src/components/detection/WebcamView.tsx"
      to: "drawMetricsOverlay"
      via: "conditional call gated on isCalibrated"
      pattern: "if.*!isCalibrated.*drawMetricsOverlay"
---

<objective>
Smooth face mesh color transitions, hide debug metrics after calibration, and remove console.log spam.

Purpose: Polish the visual experience so the face mesh provides clear, non-distracting color feedback during focus sessions. The existing `getFocusColors()` and `interpolateColor()` functions already map scores to colors correctly -- this plan adds cross-frame smoothing via RGB lerp, conditionally hides debug overlays after calibration, and removes the ~9 console.log statements that fire on every draw frame.

Output: A polished `WebcamView.tsx` where mesh colors glide between states, calibration-only metrics vanish after calibration, and the browser console stays clean.
</objective>

<execution_context>
@/Users/adiga/.claude/get-shit-done/workflows/execute-plan.md
@/Users/adiga/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-polish-visual-enhancements/06-RESEARCH.md
@src/components/detection/WebcamView.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add cross-frame color lerping and conditional metrics hiding</name>
  <files>src/components/detection/WebcamView.tsx</files>
  <action>
Three changes to WebcamView.tsx:

**1. Add a color lerp ref and helper function.**

Add a `useRef` to store the current displayed RGB as a tuple `[number, number, number]`, initialized to gray `[156, 163, 175]` (matching the calibration color). Add a helper function `getTargetRGB(score: number, isCalibrated: boolean): [number, number, number]` that returns the raw RGB target for the given score/calibration state (same thresholds as `getFocusColors` but returning numeric tuples instead of rgba strings). This avoids re-parsing the existing `getFocusColors` output.

Score-to-RGB mapping for `getTargetRGB`:
- Not calibrated: `[156, 163, 175]` (gray-400)
- score < 25: `[185, 28, 28]` (red-700)
- score 25-50: interpolate `[239, 68, 68]` to `[249, 115, 22]` (red-500 to orange-500)
- score 50-75: interpolate `[249, 115, 22]` to `[234, 179, 8]` (orange-500 to yellow-500)
- score 75-100: interpolate `[234, 179, 8]` to `[34, 197, 94]` (yellow-500 to green-500)

In the draw `useEffect`, BEFORE computing colors for `human.draw.options`:
1. Compute `targetRGB = getTargetRGB(focusScore, isCalibrated)`
2. Lerp `currentColorRef.current` toward `targetRGB` with factor `0.15`
3. Build the rgba string from the lerped RGB: `rgba(R, G, B, 0.8)` for primary, `rgba(R+40, G+40, B+40, 0.9)` clamped to 255 for secondary (lighter variant)
4. Use these lerped colors instead of calling `getFocusColors()` in the draw effect

Keep `getFocusColors()` and the existing `currentColors` computation (line 312) for the DOM data attributes and the color indicator badge -- only the canvas draw path changes to use the lerped colors.

**2. Conditionally hide metrics after calibration.**

In the draw options object (the `newOptions` object around line 233), add `drawLabels: !isCalibrated` to hide Human.js's built-in face labels after calibration.

Change the `drawMetricsOverlay` call (line 305) to be conditional:
```typescript
if (!isCalibrated) {
  drawMetricsOverlay(ctx, result, fps);
}
```

This ensures Yaw/Pitch/Roll, Gaze, Face%, FPS text AND Human.js labels are only visible during calibration.

**3. Remove all console.log and console.error statements.**

Remove all 9 `console.log('[WebcamView]...')` calls and the 1 `console.error('[WebcamView]...')` call from the component. Also remove the 3 video event listener console.log calls inside the first `useEffect` (lines 141-153). These fire on every frame (~5/sec) and flood the console.

Do NOT remove the `console.error` in the catch block of `human.draw.all()` failure (line 288) -- that is a genuine error handler, but change it from `console.error('[WebcamView] human.draw.all failed:', error)` to just `// Fallback: draw basic bounding box` (silent fallback, the visual fallback below handles it).

After removing the video event listeners' console.log calls, the first useEffect that only adds/removes video event listeners with console.log callbacks becomes empty/useless -- remove the entire useEffect block (lines 136-165).
  </action>
  <verify>
Run `npm run build` -- must compile with zero errors. Then grep for remaining console.log in WebcamView.tsx:
```bash
grep -c "console\." src/components/detection/WebcamView.tsx
```
Expected: 0 occurrences.

Verify the lerp ref exists:
```bash
grep "currentColorRef" src/components/detection/WebcamView.tsx
```
Expected: at least 2 occurrences (declaration + usage).

Verify conditional metrics:
```bash
grep "drawLabels" src/components/detection/WebcamView.tsx
```
Expected: 1 occurrence with `!isCalibrated`.

```bash
grep "drawMetricsOverlay" src/components/detection/WebcamView.tsx
```
Expected: 2 occurrences (conditional call + function definition).
  </verify>
  <done>
WebcamView.tsx compiles cleanly. Color lerp ref is declared and used in the draw loop. `drawLabels: !isCalibrated` is set in draw options. `drawMetricsOverlay` is called conditionally on `!isCalibrated`. Zero console.log/console.error statements remain in the file.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Visual verification of color transitions and metrics hiding</name>
  <what-built>
Smooth face mesh color transitions based on focus score, calibration-only debug metrics, and clean console output.
  </what-built>
  <how-to-verify>
1. Start the dev server (`npm run dev`) and navigate to `/session`
2. Grant webcam permission and wait for calibration to begin
3. **During calibration:** Verify that:
   - Face mesh is GRAY colored
   - Stacked text metrics (Yaw/Pitch/Roll, Gaze, Face%, FPS) are visible in top-left
   - Human.js face labels are visible on the mesh
4. **After calibration completes:** Verify that:
   - Stacked text metrics panel disappears
   - Human.js face labels disappear
   - Face mesh color changes to GREEN (score starts at 100)
   - The color indicator badge (top-left dot + score number) remains visible
5. **Look away from camera for 10+ seconds:** Verify that:
   - Face mesh color smoothly transitions from green -> yellow -> orange -> red
   - No abrupt color jumps at threshold boundaries (25, 50, 75)
   - Transition feels gradual, not instant
6. **Open browser console (F12):** Verify that:
   - No `[WebcamView]` log messages appear
   - Console is clean during normal operation
  </how-to-verify>
  <resume-signal>Type "approved" or describe any visual issues</resume-signal>
</task>

</tasks>

<verification>
- `npm run build` passes with zero errors
- `grep -c "console\." src/components/detection/WebcamView.tsx` returns 0
- `grep "currentColorRef" src/components/detection/WebcamView.tsx` shows lerp ref
- `grep "drawLabels.*!isCalibrated" src/components/detection/WebcamView.tsx` shows conditional labels
- `grep -B1 "drawMetricsOverlay" src/components/detection/WebcamView.tsx` shows conditional call
</verification>

<success_criteria>
1. Face mesh color smoothly transitions between focus score ranges without abrupt jumps
2. Debug metrics (stacked text + Human.js labels) visible only during calibration, hidden after
3. Browser console produces zero WebcamView log output during normal operation
4. Build compiles cleanly with no TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/06-polish-visual-enhancements/06-01-SUMMARY.md`
</output>
