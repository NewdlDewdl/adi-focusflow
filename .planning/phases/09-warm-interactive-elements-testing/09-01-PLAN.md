---
phase: 09-warm-interactive-elements-testing
plan: 01
type: execute
wave: 1
depends_on: ["08-01"]
files_modified:
  - src/components/landing/Navigation.tsx
  - src/components/landing/AnalyticsToggle.tsx
  - src/app/page.tsx
  - src/components/landing/Hero.tsx
  - tests/phase-09-warm-interactive-complete.spec.ts
autonomous: false

must_haves:
  truths:
    - "Navigation tabs (Solo/Multiplayer/Dashboard) display at top center with glass morphism"
    - "Analytics toggle positioned at top left with warm green active state"
    - "Navigation tabs have hover effects and active state styling"
    - "All interactive elements use warm theme colors and animations"
    - "Video detection remains completely untouched and functional"
    - "Comprehensive Playwright tests verify entire warm theme integration"
  artifacts:
    - path: "src/components/landing/Navigation.tsx"
      provides: "Glass morphism navigation tabs with Solo/Multiplayer/Dashboard"
      contains: "Navigation, Tab components with warm styling"
    - path: "src/components/landing/AnalyticsToggle.tsx"
      provides: "Toggle switch for analytics with warm theme styling"
      contains: "AnalyticsToggle, useState for toggle state"
    - path: "tests/phase-09-warm-interactive-complete.spec.ts"
      provides: "Comprehensive E2E tests for warm theme integration"
      contains: "navigation tests, toggle tests, video detection verification"
  key_links:
    - from: "src/app/page.tsx"
      to: "src/components/landing/Navigation.tsx"
      via: "renders Navigation component at top of page"
      pattern: "Navigation.*absolute.*top"
    - from: "src/app/page.tsx"
      to: "src/components/landing/AnalyticsToggle.tsx"
      via: "renders AnalyticsToggle component at top left"
      pattern: "AnalyticsToggle.*absolute.*left"
---

<objective>
Add interactive elements from localhost:3000/warm (Navigation tabs and Analytics toggle) to the main page, maintaining warm theme styling and ensuring all elements work harmoniously with the video detection system.

Purpose: Complete the warm theme migration by adding the final interactive UI components (navigation and analytics toggle) that make the landing page match /warm exactly, while running comprehensive tests to verify everything works together.

Output: Navigation and Analytics toggle components with warm styling, updated landing page layout, and comprehensive Playwright test suite covering all warm theme features and video detection integrity.
</objective>

<execution_context>
@/Users/adiga/.claude/get-shit-done/workflows/execute-plan.md
@/Users/adiga/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-warm-theme-ui-migration/08-01-SUMMARY.md
@src/app/page.tsx
@src/components/landing/Hero.tsx
@src/styles/warm-theme.module.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Navigation component with glass morphism tabs</name>
  <files>src/components/landing/Navigation.tsx</files>
  <action>
Create a new Navigation component with warm theme styling:

```typescript
'use client';

import { useState } from 'react';
import styles from '@/styles/warm-theme.module.css';

type Tab = 'solo' | 'multiplayer' | 'dashboard';

export default function Navigation() {
  const [activeTab, setActiveTab] = useState<Tab>('solo');

  const tabs: { id: Tab; label: string }[] = [
    { id: 'solo', label: 'Solo' },
    { id: 'multiplayer', label: 'Multiplayer' },
    { id: 'dashboard', label: 'Dashboard' },
  ];

  return (
    <nav
      className={`absolute top-4 left-1/2 -translate-x-1/2 z-50 ${styles.glassOrganic} rounded-full px-1 py-1 flex items-center gap-1 shadow-lg shadow-warmBrown/5 border border-white/60 ${styles.stateTransition}`}
    >
      {tabs.map((tab) => (
        <button
          key={tab.id}
          onClick={() => setActiveTab(tab.id)}
          className={`
            flex items-center justify-center px-4 py-1.5 rounded-full text-xs font-medium
            transition-all duration-300 hover:scale-105
            ${
              activeTab === tab.id
                ? 'text-warmBrown bg-warmBeige border border-warmBorder'
                : 'text-warmBrownMuted hover:text-warmBrown hover:bg-warmSurface/50'
            }
          `}
        >
          {tab.label}
        </button>
      ))}
    </nav>
  );
}
```

**Styling requirements:**
- Position: Absolute, top-4, horizontally centered
- Glass morphism background from CSS module
- Rounded-full for pill shape
- Tabs use warm colors (brown for active, muted for inactive)
- Hover: scale-105 transform, color change
- Active state: warm beige background with border
- z-index 50 to appear above gradient blobs
  </action>
  <verify>
```bash
grep -n "glassOrganic\|activeTab\|rounded-full" src/components/landing/Navigation.tsx
npx tsc --noEmit
```
Verify Navigation component compiles, has glass morphism, and tab state management.
  </verify>
  <done>Created Navigation component with 3 glass morphism tabs (Solo/Multiplayer/Dashboard), warm theme colors, hover scale effects, and active state styling. Component positioned at top center.</done>
</task>

<task type="auto">
  <name>Task 2: Create Analytics toggle component</name>
  <files>src/components/landing/AnalyticsToggle.tsx</files>
  <action>
Create an Analytics toggle component with warm theme styling:

```typescript
'use client';

import { useState } from 'react';

export default function AnalyticsToggle() {
  const [enabled, setEnabled] = useState(true);

  return (
    <div className="absolute top-6 left-6 z-50 flex items-center gap-3">
      <span className="text-xs font-medium tracking-widest text-warmBrownMuted">
        ANALYTICS
      </span>
      <label className="relative inline-flex items-center cursor-pointer">
        <input
          type="checkbox"
          className="sr-only peer"
          checked={enabled}
          onChange={(e) => setEnabled(e.target.checked)}
        />
        <div
          className={`
            w-11 h-6 rounded-full peer
            peer-focus:outline-none
            after:content-[''] after:absolute after:top-[2px] after:left-[2px]
            after:bg-warmBeige after:rounded-full after:h-5 after:w-5
            after:transition-all
            ${enabled ? 'bg-warmCoral peer-checked:after:translate-x-full' : 'bg-warmGreen'}
          `}
        />
      </label>
    </div>
  );
}
```

**Styling requirements:**
- Position: Absolute, top-6 left-6
- Label: "ANALYTICS" in uppercase, letter-spaced, muted brown
- Toggle switch: 11x6 (w-11 h-6)
- Toggle background: warmGreen when off, warmCoral when on
- Toggle circle: warmBeige background
- Circle slides right when enabled (translate-x-full)
- Smooth transitions on state change
- z-index 50 to appear above background elements
  </action>
  <verify>
```bash
grep -n "ANALYTICS\|warmCoral\|warmGreen" src/components/landing/AnalyticsToggle.tsx
npx tsc --noEmit
```
Verify AnalyticsToggle compiles, has checkbox state, and warm color transitions.
  </verify>
  <done>Created AnalyticsToggle component with toggle switch, warm color states (green off, coral on), smooth transitions, and positioned at top left corner.</done>
</task>

<task type="auto">
  <name>Task 3: Integrate Navigation and Analytics toggle into landing page</name>
  <files>src/app/page.tsx</files>
  <action>
Update the main page to include Navigation and Analytics components:

```typescript
import Hero from '@/components/landing/Hero';
import Navigation from '@/components/landing/Navigation';
import AnalyticsToggle from '@/components/landing/AnalyticsToggle';

export default function LandingPage() {
  return (
    <main className="min-h-screen bg-warmBeige text-warmBrown font-sans selection:bg-warmCoral/20 selection:text-warmBrown relative">
      {/* Analytics toggle - top left */}
      <AnalyticsToggle />

      {/* Navigation tabs - top center */}
      <Navigation />

      {/* Hero content */}
      <Hero />
    </main>
  );
}
```

**Layout structure:**
1. AnalyticsToggle: `absolute top-6 left-6 z-50`
2. Navigation: `absolute top-4 left-1/2 -translate-x-1/2 z-50`
3. Hero: Regular flow, centered content with animated background

**CRITICAL**: Add `relative` to main element so absolute-positioned children position correctly.

Verify:
- Toggle appears top-left
- Navigation appears top-center
- Hero content not obscured
- All elements have proper z-index stacking
  </action>
  <verify>
```bash
grep -n "AnalyticsToggle\|Navigation\|relative" src/app/page.tsx
npm run build 2>&1 | grep -E "(error|Error)" || echo "✓ Build successful"
```
Verify page imports both components, main has relative positioning, build succeeds.
  </verify>
  <done>Landing page updated with Navigation at top center and AnalyticsToggle at top left. Main element set to relative for correct absolute positioning. Hero content remains centered below interactive elements.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete warm theme landing page with navigation tabs, analytics toggle, and all visual elements matching localhost:3000/warm design.</what-built>
  <how-to-verify>
1. Open http://localhost:3000 in Chrome
2. **Visual verification:**
   - Warm beige background (#FDFBF7) with animated gradient blobs
   - "ANALYTICS" toggle at top left (green when off, coral when on)
   - Navigation tabs at top center (Solo/Multiplayer/Dashboard) with glass effect
   - Hero content: serif heading, coral cycling word, gradient button glow
3. **Interaction verification:**
   - Click Analytics toggle - should smoothly transition green <-> coral
   - Click each navigation tab - active tab should have beige background
   - Hover over inactive tabs - should show scale effect and color change
   - Hover over "Start Focus Session" button - should see gradient animation
4. **Video detection verification:**
   - Click "Start Focus Session"
   - Verify video loads and calibration runs normally
   - Verify face mesh overlay appears and changes color
   - Verify all detection features work identically to before
5. **Responsive check:**
   - Resize browser to 768px width
   - Verify navigation and toggle remain visible and functional
   - Verify no horizontal overflow
  </how-to-verify>
  <resume-signal>Type "approved" or describe any issues with navigation, toggle, or detection</resume-signal>
</task>

<task type="auto">
  <name>Task 4: Create comprehensive E2E Playwright tests</name>
  <files>tests/phase-09-warm-interactive-complete.spec.ts</files>
  <action>
Create comprehensive Playwright test suite for complete warm theme integration:

```typescript
import { test, expect } from '@playwright/test';

test.describe('Phase 09: Complete Warm Theme Integration with Interactive Elements', () => {
  test.beforeEach(async ({ page, context }) => {
    await context.grantPermissions(['camera']);
  });

  test('should display all warm theme elements on landing page', async ({ page }) => {
    await page.goto('http://localhost:3000');

    // Verify warm background
    const main = page.locator('main');
    await expect(main).toHaveCSS('background-color', /rgb\(253, 251, 247\)/);

    // Verify Analytics toggle
    const analyticsToggle = page.locator('text=ANALYTICS');
    await expect(analyticsToggle).toBeVisible();

    // Verify Navigation tabs
    await expect(page.locator('text=Solo')).toBeVisible();
    await expect(page.locator('text=Multiplayer')).toBeVisible();
    await expect(page.locator('text=Dashboard')).toBeVisible();

    // Verify Hero content
    await expect(page.locator('h1')).toContainText('Stay focused');
    await expect(page.locator('text=Start Focus Session')).toBeVisible();
  });

  test('should toggle analytics switch correctly', async ({ page }) => {
    await page.goto('http://localhost:3000');

    const toggle = page.locator('input[type="checkbox"]').first();

    // Should start checked (enabled)
    await expect(toggle).toBeChecked();

    // Get initial color
    const parent = page.locator('label').first().locator('div').first();
    const initialColor = await parent.evaluate((el) => window.getComputedStyle(el).backgroundColor);

    // Click to disable
    await toggle.click();
    await expect(toggle).not.toBeChecked();

    // Color should change
    await page.waitForTimeout(300); // Wait for transition
    const newColor = await parent.evaluate((el) => window.getComputedStyle(el).backgroundColor);
    expect(newColor).not.toBe(initialColor);
  });

  test('should switch navigation tabs with active state', async ({ page }) => {
    await page.goto('http://localhost:3000');

    const soloTab = page.locator('button:has-text("Solo")');
    const multiplayerTab = page.locator('button:has-text("Multiplayer")');
    const dashboardTab = page.locator('button:has-text("Dashboard")');

    // Solo should start active
    await expect(soloTab).toHaveClass(/bg-warmBeige/);

    // Click Multiplayer
    await multiplayerTab.click();
    await expect(multiplayerTab).toHaveClass(/bg-warmBeige/);
    await expect(soloTab).not.toHaveClass(/bg-warmBeige/);

    // Click Dashboard
    await dashboardTab.click();
    await expect(dashboardTab).toHaveClass(/bg-warmBeige/);
    await expect(multiplayerTab).not.toHaveClass(/bg-warmBeige/);
  });

  test('should show hover effects on navigation tabs', async ({ page }) => {
    await page.goto('http://localhost:3000');

    const multiplayerTab = page.locator('button:has-text("Multiplayer")');

    // Get initial transform
    const initialTransform = await multiplayerTab.evaluate((el) =>
      window.getComputedStyle(el).transform
    );

    // Hover
    await multiplayerTab.hover();
    await page.waitForTimeout(200);

    const hoverTransform = await multiplayerTab.evaluate((el) =>
      window.getComputedStyle(el).transform
    );

    // Transform should change (scale effect)
    expect(hoverTransform).not.toBe(initialTransform);
  });

  test('should navigate to session and preserve video detection', async ({ page }) => {
    await page.goto('http://localhost:3000');

    // Click CTA button
    await page.click('text=Start Focus Session');
    await page.waitForURL('**/session');

    // Verify video detection loads
    await page.waitForSelector('[data-testid="webcam-view"]', { timeout: 10000 });

    const video = page.locator('video');
    await expect(video).toBeVisible();

    // Verify video stream active
    const hasStream = await video.evaluate((v: HTMLVideoElement) => {
      return v.videoWidth > 0 && v.videoHeight > 0 && !v.paused;
    });
    expect(hasStream).toBe(true);

    // Verify canvas overlay
    await expect(page.locator('canvas')).toBeVisible();
  });

  test('should have animated gradient blobs in background', async ({ page }) => {
    await page.goto('http://localhost:3000');

    // Count gradient blob divs (should have 3)
    const blobs = page.locator('div[class*="rounded-full blur"]');
    const count = await blobs.count();
    expect(count).toBeGreaterThanOrEqual(3);

    // Verify they have animation classes
    const firstBlob = blobs.first();
    const className = await firstBlob.getAttribute('class');
    expect(className).toContain('animate');
  });

  test('should have glass morphism on navigation', async ({ page }) => {
    await page.goto('http://localhost:3000');

    const nav = page.locator('nav').first();

    // Check for backdrop-filter (glass effect)
    const backdropFilter = await nav.evaluate((el) =>
      window.getComputedStyle(el).backdropFilter ||
      window.getComputedStyle(el).webkitBackdropFilter
    );

    expect(backdropFilter).toContain('blur');
  });

  test('should maintain warm theme after session and back navigation', async ({ page }) => {
    await page.goto('http://localhost:3000');

    // Go to session
    await page.click('text=Start Focus Session');
    await page.waitForURL('**/session');
    await page.waitForTimeout(2000);

    // Go back
    await page.goBack();
    await page.waitForURL('http://localhost:3000');

    // Verify warm theme persists
    const main = page.locator('main');
    await expect(main).toHaveCSS('background-color', /rgb\(253, 251, 247\)/);
    await expect(page.locator('text=ANALYTICS')).toBeVisible();
    await expect(page.locator('text=Solo')).toBeVisible();
  });

  test('should have correct text selection colors', async ({ page }) => {
    await page.goto('http://localhost:3000');

    // Select text
    await page.locator('h1').click({ clickCount: 3 }); // Triple-click to select

    // Get selection style (check via computed style)
    const selectionColor = await page.evaluate(() => {
      const selection = window.getSelection();
      if (!selection || selection.rangeCount === 0) return null;

      const range = selection.getRangeAt(0);
      const dummy = document.createElement('span');
      range.insertNode(dummy);

      const style = window.getComputedStyle(dummy, '::selection');
      dummy.remove();

      return style.backgroundColor;
    });

    // Should have warm selection color
    expect(selectionColor).toBeTruthy();
  });

  test('should be responsive at 768px width', async ({ page }) => {
    await page.setViewportSize({ width: 768, height: 1024 });
    await page.goto('http://localhost:3000');

    // Verify elements still visible
    await expect(page.locator('text=ANALYTICS')).toBeVisible();
    await expect(page.locator('nav')).toBeVisible();
    await expect(page.locator('text=Start Focus Session')).toBeVisible();

    // Verify no horizontal scroll
    const hasHorizontalScroll = await page.evaluate(() => {
      return document.body.scrollWidth > window.innerWidth;
    });
    expect(hasHorizontalScroll).toBe(false);
  });

  test('should complete full user journey with video detection', async ({ page }) => {
    // Landing page
    await page.goto('http://localhost:3000');
    await expect(page.locator('h1')).toContainText('Stay focused');

    // Interact with toggle
    await page.locator('input[type="checkbox"]').first().click();
    await page.waitForTimeout(300);

    // Interact with navigation
    await page.click('text=Multiplayer');
    await page.waitForTimeout(200);

    // Start session
    await page.click('text=Start Focus Session');
    await page.waitForURL('**/session');

    // Wait for video detection
    await page.waitForSelector('video', { timeout: 10000 });

    // Verify detection running
    const video = page.locator('video');
    const isPaused = await video.evaluate((v: HTMLVideoElement) => v.paused);
    expect(isPaused).toBe(false);

    // Verify face mesh
    await expect(page.locator('canvas')).toBeVisible();

    // Take screenshot for documentation
    await page.screenshot({ path: 'test-results/phase-09-complete.png', fullPage: true });
  });
});
```
  </action>
  <verify>
```bash
npx playwright test tests/phase-09-warm-interactive-complete.spec.ts --list
```
Verify 11 comprehensive tests are discovered.
  </verify>
  <done>Created E2E test suite with 11 comprehensive tests covering: warm theme elements, analytics toggle, navigation tabs, hover effects, session navigation, video detection preservation, gradient blobs, glass morphism, theme persistence, selection colors, responsiveness, and full user journey.</done>
</task>

<task type="auto">
  <name>Task 5: Run comprehensive Playwright tests and verify complete integration</name>
  <files>N/A</files>
  <action>
Execute the complete Playwright test suite to verify all warm theme features and video detection:

```bash
# Run all warm theme tests (Phase 08 + Phase 09)
npx playwright test tests/phase-08-video-detection-integrity.spec.ts tests/phase-09-warm-interactive-complete.spec.ts --headed --project=chromium

# Generate HTML report
npx playwright test tests/phase-08-video-detection-integrity.spec.ts tests/phase-09-warm-interactive-complete.spec.ts --reporter=html
```

**Expected results:**
- Phase 08: 5/5 tests pass (video detection integrity)
- Phase 09: 11/11 tests pass (warm theme + interactivity)
- **Total: 16/16 tests passing**

**Test coverage:**
✓ Warm theme visual elements
✓ Color palette correctness
✓ Analytics toggle functionality
✓ Navigation tab switching
✓ Hover effects
✓ Glass morphism effects
✓ Animated gradient blobs
✓ Video detection unchanged
✓ Session navigation flow
✓ Theme persistence
✓ Text selection styling
✓ Responsive layout
✓ Full user journey E2E

If any test fails:
1. Review error details in test output
2. Check if warm theme conflicts with detection
3. Verify component imports and styling
4. Fix issues and re-run tests
5. Ensure all 16 tests pass before completion

**Generate final report:**
```bash
npx playwright show-report
```

Opens HTML report in browser showing all test results, screenshots, and traces.
  </action>
  <verify>
```bash
npx playwright test tests/phase-08-video-detection-integrity.spec.ts tests/phase-09-warm-interactive-complete.spec.ts --reporter=list | grep -E "passed|failed"
```
Verify 16 passed, 0 failed.
  </verify>
  <done>Executed comprehensive Playwright test suite. All 16 tests pass: 5 video detection integrity tests + 11 warm theme interactive tests. HTML report generated. Screenshots captured. Complete warm theme integration verified with zero regressions to video detection.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes (no TypeScript errors)
2. `npm run build` succeeds (Next.js build completes)
3. Landing page shows complete warm theme: navigation, toggle, gradients, glass effects
4. Analytics toggle functional (green <-> coral transition)
5. Navigation tabs functional (active state, hover effects)
6. Video detection 100% functional after clicking "Start Focus Session"
7. All 16 Playwright tests pass (8 + 11)
8. No CSS conflicts between warm theme and detection components
9. Responsive layout works at 768px+
10. Full user journey works: landing -> toggle/nav interaction -> session -> video detection
</verification>

<success_criteria>
- Complete warm theme integration matching localhost:3000/warm
- Navigation tabs with glass morphism and active states
- Analytics toggle with warm color transitions
- All interactive elements functional
- Video detection system 100% preserved
- 16/16 Playwright tests passing
- No regressions to any existing functionality
- Responsive design verified
</success_criteria>

<output>
After completion, create `.planning/phases 2/09-warm-interactive-elements-testing/09-01-SUMMARY.md`
</output>
